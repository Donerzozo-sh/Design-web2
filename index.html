<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="web-title">çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¼ºåˆ¶ä½¿ç”¨ Helvetica Now Display å­—ä½“ï¼Œå¹¶æä¾›ç³»ç»Ÿå›é€€ */
        body {
            font-family: 'Helvetica Now Display', 'Helvetica Neue', 'Arial', sans-serif;
            /* éšè—æ»šåŠ¨æ¡ï¼Œæ‰“é€ åº”ç”¨æ„Ÿ */
            overflow: hidden;
            padding-top: 0; 
            background-color: #000;
            min-height: 100vh;
            user-select: none;
        }

        #grid-container {
            cursor: default; 
            width: 140vw;
            height: 140vh;
        }

        .grid-item {
            /* å…³é”®ï¼šç¨å¾®å¢åŠ è¿‡æ¸¡æ—¶é—´ (0.1s -> 0.15s) ä»¥æå‡è§†è§‰å¹³æ»‘æ„Ÿ */
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                        opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                        filter 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            
            will-change: transform, opacity, filter;
            opacity: 0.7;
        }

        /* éšè—åŸç”Ÿé¢œè‰²é€‰æ‹©å™¨çš„è¾“å…¥æ¡† */
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }
    </style>
    <!-- å¼•å…¥ Firebase SDK (éœ€è¦ Firestore å’Œ Auth) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ======================================================================
        // ** ã€ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®é…ç½®åŒºåŸŸï¼šæ‰‹åŠ¨é…ç½® Firebase Firestore ğŸ”¥ğŸ”¥ğŸ”¥ã€‘ **
        // ======================================================================
        
        // 1. åº”ç”¨ ID (é‡è¦ï¼šç”¨äºæ„å»º Firestore è·¯å¾„)
        const appId = 'design-c9479'; 

        // 2. Firebase é…ç½®å¯¹è±¡ (å·²æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®é…ç½®)
        const firebaseConfig = {
            apiKey: "AIzaSyDApuOEfnj7x7lg7T-3xceKQMlRvcdJV68",
            authDomain: "design-c9479.firebaseapp.com",
            projectId: "design-c9479",
            storageBucket: "design-c9479.firebasestorage.app",
            messagingSenderId: "779638854632",
            appId: "1:779638854632:web:cd467e5c88cb87c2de0a5d",
            measurementId: "G-RRL6LEV1NV"
        };
        
        // 3. åˆå§‹èº«ä»½éªŒè¯ä»¤ç‰Œ (åœ¨ GitHub Pages/Vercel ç¯å¢ƒä¸­ä¿æŒ null å³å¯ï¼Œå¼ºåˆ¶åŒ¿åç™»å½•)
        const initialAuthToken = null; 
        
        // ======================================================================
        // ** é…ç½®ç»“æŸ **
        // ======================================================================

        // --- Firebase & State Variables ---
        let db, auth; 
        let isLocalMode = false;

        // --- DOM å…ƒç´ å£°æ˜ ---
        let gridContainer, modal, videoPlayer, closeModal, mainTitleEl, subTextEl;
        let editContainer, contentDisplay, editTitleEl, editSubtitleEl, topContentArea;
        let editWebTitleEl, editTitleSizeEl, editTitleWeightEl, editTitleColorPickerEl, editTitleSpacingEl;
        let editSubtitleSizeEl, editSubtitleWeightEl, editSubtitleColorPickerEl, editSubtitleSpacingEl;
        let adminToggleBtn, itemEditModal, itemEditIdEl, editImageUrlEl, editVideoUrlEl;
        let authModal, authUsernameEl, authPasswordEl, authErrorMessageEl;
        
        // ** è§†è§‰å‚æ•°ç¼–è¾‘å…ƒç´  **
        let editFisheyeRadiusEl, editDecayPowerEl, editMinScaleEl, editMaxScaleEl;
        let editParallaxSmoothingEl; 


        // --- é…ç½®/çŠ¶æ€å˜é‡ ---
        const NUM_COLS = 14; 
        const NUM_ROWS = 10; 
        const TOTAL_ITEMS = NUM_COLS * NUM_ROWS;
        const PLACEHOLDER_VID = "https://www.w3schools.com/html/mov_bbb.mp4"; // é»˜è®¤è§†é¢‘å ä½ç¬¦

        // ** åŠ¨æ€äº¤äº’å‚æ•° **
        let currentFisheyeRadius = 300;
        let currentDecayPower = 2.0; // é±¼çœ¼è¡°å‡å¹…åº¦ (æŒ‡æ•°)
        let currentMinScale = 0.175; // åˆå§‹å¤§å°
        let currentMaxScale = 3.0; // æœ€å¤§æ”¾å¤§å€æ•°
        let currentParallaxSmoothing = 0.2; // ã€åŠ¨æ€ã€‘å¹³æ»‘åº¦å‚æ•° (å›æ»šåçš„é»˜è®¤å€¼)

        // å›ºå®šçš„è§†å·®å¼ºåº¦
        const PARALLAX_INTENSITY = 0.1; 

        // é»˜è®¤è§†è§‰è®¾ç½®
        const DEFAULT_FISHEYE_SETTINGS = {
            radius: 300,
            decayPower: 2.0,
            minScale: 0.175,
            maxScale: 3.0, 
            parallaxSmoothing: 0.2, // å¹³æ»‘åº¦é»˜è®¤å€¼
        };

        const GRID_COLORS = [
            '#EF4444', '#F97316', '#F59E0B', '#10B981', '#3B82F6', 
            '#6366F1', '#8B5CF6', '#EC4899', '#FBBF24', '#A78BFA', 
            '#4ADE80', '#FB7185', '#D946EF', '#06B6D4', 
        ];

        function getColumnIndex(index) {
            return index % NUM_COLS;
        }

        function getColorForColumn(colIndex) {
            return GRID_COLORS[colIndex % GRID_COLORS.length];
        }


        const DEFAULT_CONTENT = {
            title: "3D&Motion Creative&Production",
            subtitle: "Powerd by REDesign",
            webTitle: "çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†",
            titleStyle: { size: 'text-8xl', weight: 'font-extrabold', color: '#FFFFFF', spacing: 'tracking-normal' },
            subtitleStyle: { size: 'text-2xl', weight: 'font-normal', color: '#9CA3AF', spacing: 'tracking-normal' }
        };

        let items = []; 
        let itemData = {}; 
        let mousePos = { x: 0, y: 0 }; 
        let isMouseActive = false; 
        let animationFrameId = null; 
        let parallaxOffset = { x: 0, y: 0 }; 
        let isAdminMode = false;
        let editingItemId = null; 

        // ä½¿ç”¨ç¡¬ç¼–ç çš„ appId æ¥æ„å»º Firestore è·¯å¾„
        const getSettingsDocPath = (appIdentifier) => `/artifacts/${appIdentifier}/public/data/homepage_content/settings`;
        const getGridCollectionPath = (appIdentifier) => `/artifacts/${appIdentifier}/public/data/grid_items`;


        // --- æ ·å¼è¾…åŠ©å‡½æ•° (ä¿æŒä¸å˜) ---

        function applyTextStyles(element, styleData, isTitle) {
            if (!element) return; 

            const prefixesToClear = [
                'text-', 'font-', 'tracking-' 
            ];
            
            element.className = element.className.split(' ').filter(c => 
                !prefixesToClear.some(prefix => c.startsWith(prefix))
            ).join(' ');

            if (styleData.size) element.classList.add(styleData.size);
            if (styleData.weight) element.classList.add(styleData.weight);
            if (styleData.spacing) element.classList.add(styleData.spacing);
            
            element.style.color = styleData.color || (isTitle ? '#FFFFFF' : '#9CA3AF');

            if (isTitle) {
                element.classList.add('mb-4', 'transition-colors', 'duration-500', 'hover:text-yellow-400', 'cursor-text');
                element.classList.add('md:text-8xl'); 
            } else {
                element.classList.add('transition-colors', 'duration-500', 'hover:text-gray-200', 'cursor-text');
                element.classList.add('md:text-2xl'); 
            }
        }

        // --- Admin/Auth é€»è¾‘ ---

        window.setAdminMode = (mode) => {
            isAdminMode = mode;
            if (!adminToggleBtn || !topContentArea) return; 

            // 1. æ–‡æœ¬æ”¹ä¸º (R)
            adminToggleBtn.textContent = '(R)';
            
            // 2. æ¸…é™¤æ‰€æœ‰é¢œè‰²/èƒŒæ™¯ç±»
            adminToggleBtn.classList.remove('text-black', 'text-white', 'bg-red-600', 'hover:bg-red-700', 'bg-gray-300', 'hover:bg-gray-400', 'text-sm');
            adminToggleBtn.classList.add('text-base', 'font-bold');

            if (mode) {
                // ON: ç™½è‰²æ–‡å­—, çº¢è‰²èƒŒæ™¯
                adminToggleBtn.classList.add('text-white', 'bg-red-600', 'hover:bg-red-700');
                topContentArea.classList.add('border-b-4', 'border-red-600');
                window.closeAuthModal(); 
                
                // ** ã€æ–°å¢ã€‘è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼æ—¶ï¼Œç«‹å³å¤ä½ç½‘æ ¼ç¼©æ”¾çŠ¶æ€ **
                resetGridScale();
                console.log("Admin Mode activated. Grid scales reset.");
            } else {
                // OFF: é»‘è‰²æ–‡å­—, æµ…ç°èƒŒæ™¯
                adminToggleBtn.classList.add('text-black', 'bg-gray-300', 'hover:bg-gray-400');
                topContentArea.classList.remove('border-b-4', 'border-red-600');
                console.log("Admin Mode deactivated.");
            }
        };

        window.handleAdminToggle = () => {
            if (!adminToggleBtn) return; 
            if (isAdminMode) {
                window.setAdminMode(false);
            } else {
                window.openAuthModal();
            }
        };

        window.openAuthModal = () => {
            if (!authModal || !authErrorMessageEl || !authPasswordEl) return; 

            authErrorMessageEl.classList.add('hidden'); 
            // ç§»é™¤è‡ªåŠ¨å¡«å……å¯†ç ï¼Œæ”¹ä¸ºæ¸…ç©º
            authPasswordEl.value = ''; 
            authUsernameEl.value = 'admin'; // ä¿ç•™ç”¨æˆ·åå¡«å……
            authModal.classList.remove('hidden');
        };

        window.closeAuthModal = () => {
            if (!authModal) return; 
            authModal.classList.add('hidden');
        };

        window.handleAdminLogin = () => {
            if (!authUsernameEl || !authPasswordEl || !authErrorMessageEl) return; 

            const username = authUsernameEl.value.trim();
            const password = authPasswordEl.value.trim();
            
            const correctUsername = 'admin';
            const correctPassword = '1234'; 

            if (username === correctUsername && password === correctPassword) {
                window.setAdminMode(true);
            } else {
                authErrorMessageEl.classList.remove('hidden');
                authPasswordEl.value = ''; // ç™»å½•å¤±è´¥æ—¶æ¸…ç©ºå¯†ç 
            }
        };

        /**
         * åˆ‡æ¢ç¼–è¾‘æ¨¡å¼ (é¡¶éƒ¨æ–‡æœ¬ & è§†è§‰å‚æ•°)
         */
        window.toggleEditMode = (enable) => {
            if (!isAdminMode || !editContainer || !contentDisplay || !mainTitleEl || !subTextEl) {
                return; 
            }
            
            if (enable) {
                const titleStyle = mainTitleEl.dataset.style ? JSON.parse(mainTitleEl.dataset.style) : DEFAULT_CONTENT.titleStyle;
                const subtitleStyle = subTextEl.dataset.style ? JSON.parse(subTextEl.dataset.style) : DEFAULT_CONTENT.subtitleStyle;

                // å¡«å……ç½‘ç«™åç§°
                document.getElementById('web-title').textContent = DEFAULT_CONTENT.webTitle; 
                editWebTitleEl.value = document.getElementById('web-title').textContent;

                // å¡«å……æ–‡æœ¬å†…å®¹
                editTitleEl.value = mainTitleEl.textContent;
                editSubtitleEl.value = subTextEl.textContent;

                // å¡«å……ä¸»æ ‡é¢˜æ ·å¼
                editTitleSizeEl.value = titleStyle.size;
                editTitleWeightEl.value = titleStyle.weight;
                editTitleColorPickerEl.value = titleStyle.color;
                editTitleSpacingEl.value = titleStyle.spacing;

                // å¡«å……å‰¯æ ‡é¢˜æ ·å¼
                editSubtitleSizeEl.value = subtitleStyle.size;
                editSubtitleWeightEl.value = subtitleStyle.weight;
                editSubtitleColorPickerEl.value = subtitleStyle.color;
                editSubtitleSpacingEl.value = subtitleStyle.spacing;
                
                // ** å¡«å……è§†è§‰å‚æ•° **
                editFisheyeRadiusEl.value = currentFisheyeRadius;
                editDecayPowerEl.value = currentDecayPower;
                editMinScaleEl.value = currentMinScale;
                editMaxScaleEl.value = currentMaxScale; 
                editParallaxSmoothingEl.value = currentParallaxSmoothing; // å¡«å……å¹³æ»‘åº¦
                

                contentDisplay.classList.add('hidden');
                editContainer.classList.remove('hidden');
            } else {
                contentDisplay.classList.remove('hidden');
                editContainer.classList.add('hidden');
            }
        };

        /**
         * ä¿å­˜å†…å®¹åˆ° Firestore (é¡¶éƒ¨æ–‡æœ¬ & è§†è§‰å‚æ•°)
         */
        window.saveContent = async () => {
            if (!editWebTitleEl || !editTitleEl || !editSubtitleEl || !editFisheyeRadiusEl) {
                return console.error("Missing edit elements. Cannot save."); 
            }

            const newWebTitle = editWebTitleEl.value.trim(); 
            const newTitle = editTitleEl.value.trim();
            const newSubtitle = editSubtitleEl.value.trim();

            if (isLocalMode || !db || !appId) return console.error("Firestore is not initialized. Cannot save in local mode. Please check Firebase config.");
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");

            const docRef = doc(db, getSettingsDocPath(appId));
            
            const newTitleStyle = {
                size: editTitleSizeEl.value,
                weight: editTitleWeightEl.value,
                color: editTitleColorPickerEl.value,
                spacing: editTitleSpacingEl.value,
            };

            const newSubtitleStyle = {
                size: editSubtitleSizeEl.value,
                weight: editSubtitleWeightEl.value,
                color: editSubtitleColorPickerEl.value,
                spacing: editSubtitleSpacingEl.value,
            };
            
            // ** æ”¶é›†æ–°çš„è§†è§‰å‚æ•° (åŒ…æ‹¬å¹³æ»‘åº¦) **
            const newFisheyeSettings = {
                radius: parseFloat(editFisheyeRadiusEl.value) || DEFAULT_FISHEYE_SETTINGS.radius,
                decayPower: parseFloat(editDecayPowerEl.value) || DEFAULT_FISHEYE_SETTINGS.decayPower,
                minScale: parseFloat(editMinScaleEl.value) || DEFAULT_FISHEYE_SETTINGS.minScale,
                maxScale: parseFloat(editMaxScaleEl.value) || DEFAULT_FISHEYE_SETTINGS.maxScale, 
                parallaxSmoothing: parseFloat(editParallaxSmoothingEl.value) || DEFAULT_FISHEYE_SETTINGS.parallaxSmoothing, // æ”¶é›†å¹³æ»‘åº¦
            };

            try {
                await setDoc(docRef, {
                    webTitle: newWebTitle || DEFAULT_CONTENT.webTitle, 
                    title: newTitle || DEFAULT_CONTENT.title,
                    subtitle: newSubtitle || DEFAULT_CONTENT.subtitle,
                    titleStyle: newTitleStyle,
                    subtitleStyle: newSubtitleStyle,
                    fisheyeSettings: newFisheyeSettings, // ä¿å­˜åŒ…å«å¹³æ»‘åº¦çš„æ–°è§†è§‰å‚æ•°
                    timestamp: new Date()
                });
                console.log("Content and Settings saved successfully.");
                window.toggleEditMode(false);
            } catch (e) {
                console.error("Error saving document: ", e);
            }
        };

        /**
         * æœ¬åœ°å›é€€é€»è¾‘ï¼šå¦‚æœæ— æ³•è¿æ¥ Firebaseï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ•°æ®å¹¶ç«‹å³æ¸²æŸ“ã€‚
         */
        window.runLocalFallback = () => {
            if (!mainTitleEl || !subTextEl || !gridContainer) {
                 console.error("Critical DOM elements not found for fallback.");
                 return;
            }
            isLocalMode = true;
            console.warn("Firebase connection failed. Running in Local Mode (Read-Only) with default data.");
            
            // ç«‹å³åº”ç”¨é»˜è®¤å†…å®¹
            document.title = DEFAULT_CONTENT.webTitle; 
            mainTitleEl.textContent = DEFAULT_CONTENT.title;
            subTextEl.textContent = DEFAULT_CONTENT.subtitle;
            applyTextStyles(mainTitleEl, DEFAULT_CONTENT.titleStyle, true);
            applyTextStyles(subTextEl, DEFAULT_CONTENT.subtitleStyle, false);
            
            // åº”ç”¨é»˜è®¤è§†è§‰å‚æ•°
            currentFisheyeRadius = DEFAULT_FISHEYE_SETTINGS.radius;
            currentDecayPower = DEFAULT_FISHEYE_SETTINGS.decayPower;
            currentMinScale = DEFAULT_FISHEYE_SETTINGS.minScale;
            currentMaxScale = DEFAULT_FISHEYE_SETTINGS.maxScale;
            currentParallaxSmoothing = DEFAULT_FISHEYE_SETTINGS.parallaxSmoothing; // åº”ç”¨é»˜è®¤å¹³æ»‘åº¦

            // åˆå§‹åŒ–ç½‘æ ¼æ•°æ®å¹¶æ¸²æŸ“
            initializeDefaultGridData(); 
            createGrid(); 
            startAnimationLoop(); 
            window.setAdminMode(false); // ç¡®ä¿åœ¨å›é€€æ¨¡å¼ä¸‹ä¹Ÿåº”ç”¨æ­£ç¡®çš„æŒ‰é’®æ ·å¼
        };


        /**
         * ç›‘å¬ Firestore ä¸Šçš„å†…å®¹å˜åŒ–
         */
        window.setupContentListener = (firestore, appIdentifier) => {
            if (!mainTitleEl || !subTextEl) return; 
            
            const docRef = doc(firestore, getSettingsDocPath(appIdentifier)); 

            onSnapshot(docRef, (docSnap) => {
                let data = {};
                if (docSnap.exists()) {
                    data = docSnap.data();
                }

                // --- 1. æ›´æ–°é¡¶éƒ¨æ–‡æœ¬å’Œæ ·å¼ ---
                const currentWebTitle = data.webTitle || DEFAULT_CONTENT.webTitle; 
                const currentTitle = data.title || DEFAULT_CONTENT.title;
                const currentSubtitle = data.subtitle || DEFAULT_CONTENT.subtitle;
                const currentTitleStyle = data.titleStyle || DEFAULT_CONTENT.titleStyle;
                const currentSubtitleStyle = data.subtitleStyle || DEFAULT_CONTENT.subtitleStyle;

                document.title = currentWebTitle; 
                mainTitleEl.textContent = currentTitle;
                subTextEl.textContent = currentSubtitle;

                applyTextStyles(mainTitleEl, currentTitleStyle, true);
                applyTextStyles(subTextEl, currentSubtitleStyle, false);

                mainTitleEl.dataset.style = JSON.stringify(currentTitleStyle);
                subTextEl.dataset.style = JSON.stringify(currentSubtitleStyle);

                // --- 2. æ›´æ–°è§†è§‰å‚æ•° ---
                const settings = data.fisheyeSettings || DEFAULT_FISHEYE_SETTINGS;
                currentFisheyeRadius = settings.radius;
                currentDecayPower = settings.decayPower;
                currentMinScale = settings.minScale;
                currentMaxScale = settings.maxScale || DEFAULT_FISHEYE_SETTINGS.maxScale; 
                currentParallaxSmoothing = settings.parallaxSmoothing || DEFAULT_FISHEYE_SETTINGS.parallaxSmoothing; // æ›´æ–°å¹³æ»‘åº¦
                
                // ç¡®ä¿ç½‘æ ¼æ›´æ–°åˆå§‹å¤§å°
                updateGridDOM(); 

            }, (error) => {
                console.error("Error listening to content:", error);
            });
        };

        /**
         * ç›‘å¬ Firestore ä¸Šçš„ç½‘æ ¼é¡¹ç›®å˜åŒ–
         */
        window.setupGridListener = (firestore, appIdentifier) => {
            if (!gridContainer) return; 
            
            const colRef = collection(firestore, getGridCollectionPath(appIdentifier)); 

            onSnapshot(colRef, (snapshot) => {
                let initialLoad = Object.keys(itemData).length === 0;
                
                const newItemsFromFirestore = {};
                snapshot.docChanges().forEach(change => {
                    const data = change.doc.data();
                    const itemId = change.doc.id;
                    const i = parseInt(itemId.split('_')[1]);
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    newItemsFromFirestore[itemId] = {
                        img: data.img || null, 
                        vid: data.vid || PLACEHOLDER_VID,
                        bgColor: data.bgColor || defaultColor 
                    };
                });
                itemData = newItemsFromFirestore;

                if (initialLoad) {
                    let needsDefaultInit = false;
                    for (let i = 0; i < TOTAL_ITEMS; i++) {
                        const itemId = `item_${i}`;
                        if (!itemData[itemId]) {
                            needsDefaultInit = true;
                            break;
                        }
                    }

                    if(needsDefaultInit) {
                        initializeDefaultGridData();
                    }
                    createGrid();
                } else {
                    updateGridDOM();
                }
            }, async (error) => {
                console.error("Error listening to grid items:", error);
                if (Object.keys(itemData).length === 0) {
                    await initializeDefaultGridData();
                    createGrid();
                }
            });
        };
        
        /**
         * åˆå§‹åŒ–é»˜è®¤ç½‘æ ¼æ•°æ® (æœ¬åœ°æ¨¡å¼ä¸‹ä¸å†™å…¥ DB)
         */
        async function initializeDefaultGridData() {
            if (!gridContainer) return; 

            if (isLocalMode) {
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    itemData[itemId] = {
                        img: null,
                        vid: PLACEHOLDER_VID,
                        bgColor: getColorForColumn(colIndex)
                    };
                }
                return; 
            }

            if (!db || !appId) return console.error("Firestore DB/App ID not ready for default initialization.");

            const colRef = collection(db, getGridCollectionPath(appId));
            const snapshot = await getDocs(colRef);

            if (snapshot.empty) {
                console.log("No existing grid data. Initializing default items.");
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    itemData[itemId] = {
                        img: null, 
                        vid: PLACEHOLDER_VID,
                        bgColor: defaultColor
                    };
                    if (i < 5) { 
                        await setDoc(doc(db, getGridCollectionPath(appId), itemId), itemData[itemId]);
                    }
                }
            } else {
                 snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const i = parseInt(doc.id.split('_')[1]);
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    itemData[doc.id] = {
                        img: data.img || null,
                        vid: data.vid || PLACEHOLDER_VID,
                        bgColor: data.bgColor || defaultColor
                    };
                });
            }
        }
        
        function createGrid() {
            if (items.length > 0 || !gridContainer) return; 
            
            gridContainer.innerHTML = ''; 
            gridContainer.style.gridTemplateColumns = `repeat(${NUM_COLS}, 1fr)`;

            for (let i = 0; i < TOTAL_ITEMS; i++) {
                const itemId = `item_${i}`;
                const data = itemData[itemId]; 

                const item = document.createElement('div');
                item.className = 'grid-item aspect-square bg-cover bg-center cursor-pointer';
                
                if (data && data.img && data.img.trim()) {
                    item.style.backgroundImage = `url(${data.img})`;
                    item.style.backgroundColor = 'transparent';
                } else if (data && data.bgColor) {
                    item.style.backgroundImage = 'none';
                    item.style.backgroundColor = data.bgColor;
                } else {
                    const colIndex = getColumnIndex(i);
                    item.style.backgroundImage = 'none';
                    item.style.backgroundColor = getColorForColumn(colIndex);
                }

                // ** åº”ç”¨åŠ¨æ€åˆå§‹å¤§å° **
                item.style.transform = `scale(${currentMinScale})`; 
                item.style.opacity = '0.7'; 

                item.dataset.videoId = itemId;
                
                gridContainer.appendChild(item);
                
                item.twinklePhase = Math.random() * 2 * Math.PI;
                item.twinkleSpeed = 0.5 + Math.random() * 0.5;

                items.push({ 
                    el: item, 
                    center: { x: 0, y: 0 },
                    twinklePhase: item.twinklePhase,
                    twinkleSpeed: item.twinkleSpeed
                });
            }
            
            cacheItemPositions();
        }

        function updateGridDOM() {
            if (items.length === 0 || !gridContainer) return; 

            for(let i = 0; i < items.length; i++) {
                const itemId = `item_${i}`;
                const data = itemData[itemId];
                const itemEl = items[i].el;
                
                if (data) { 
                    if (data.img && data.img.trim()) {
                        itemEl.style.backgroundImage = `url(${data.img})`;
                        itemEl.style.backgroundColor = 'transparent';
                    } else {
                        itemEl.style.backgroundImage = 'none';
                        itemEl.style.backgroundColor = data.bgColor;
                    }
                } else {
                    const itemIndex = parseInt(itemId.split('_')[1]);
                    const colIndex = getColumnIndex(itemIndex);
                    itemEl.style.backgroundImage = 'none';
                    itemEl.style.backgroundColor = getColorForColumn(colIndex);
                }
                
                // ** åœ¨æ›´æ–°æ—¶åº”ç”¨æ–°çš„åˆå§‹å¤§å°ï¼ˆå¦‚æœç½‘æ ¼å·²ç»åˆ›å»ºï¼‰ **
                if (!itemEl.style.transform.includes('scale(') || itemEl.style.transform.includes('scale(0.')) {
                     // ä»…åœ¨å…ƒç´ æœªè¢«é±¼çœ¼æ”¾å¤§æ—¶åº”ç”¨åˆå§‹å¤§å°
                    itemEl.style.transform = `scale(${currentMinScale})`;
                }
            }
        }

        window.openItemEditPanel = (itemElement) => {
            if (!itemEditModal || !itemEditIdEl || !editImageUrlEl || !editVideoUrlEl) return; 
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");
            if (isLocalMode) return console.error("Cannot edit in local mode. Requires Firebase connection.");

            editingItemId = itemElement.dataset.videoId;
            let data = itemData[editingItemId]; 
            
            if (!data) {
                const parts = editingItemId.split('_');
                if (parts.length < 2) return console.error("Invalid item ID format:", editingItemId);
                
                const itemIndex = parseInt(parts[1]);
                const colIndex = getColumnIndex(itemIndex);
                
                data = { img: null, vid: PLACEHOLDER_VID, bgColor: getColorForColumn(colIndex) };
            }

            itemEditIdEl.textContent = `(ID: ${editingItemId})`;
            editImageUrlEl.value = data.img || ''; 
            editVideoUrlEl.value = data.vid;
            
            itemEditModal.classList.remove('hidden');
        };
        
        window.closeItemEditPanel = () => {
            if (!itemEditModal) return; 
            itemEditModal.classList.add('hidden');
            editingItemId = null;
        };

        window.saveItemChanges = async () => {
            if (!editImageUrlEl || !editVideoUrlEl) return; 

            const newImg = editImageUrlEl.value.trim();
            const newVid = editVideoUrlEl.value.trim();

            if (isLocalMode || !db || !appId || !editingItemId) return console.error("Invalid state for saving. Cannot save in local mode.");
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");

            const itemIndex = parseInt(editingItemId.split('_')[1]);
            const colIndex = getColumnIndex(itemIndex);
            const defaultColor = getColorForColumn(colIndex);

            const dataToSave = { 
                vid: newVid,
                bgColor: itemData[editingItemId]?.bgColor || defaultColor, 
            };
            
            if (newImg) {
                dataToSave.img = newImg; 
            } else {
                dataToSave.img = null; 
            }

            const docRef = doc(db, getGridCollectionPath(appId), editingItemId);

            try {
                await setDoc(docRef, dataToSave, { merge: true }); 
                console.log(`Item ${editingItemId} saved successfully.`);
                window.closeItemEditPanel();
            } catch (e) {
                console.error("Error saving grid item: ", e);
            }
        };

        /**
         * 1. è·å–æ‰€æœ‰ DOM å…ƒç´ çš„å¼•ç”¨
         * 2. ç»‘å®šæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
         */
        function setupDOMAndListeners() {
            // --- 1. DOM å…ƒç´ è·å– ---
            gridContainer = document.getElementById('grid-container');
            modal = document.getElementById('video-modal');
            videoPlayer = document.getElementById('video-player');
            closeModal = document.getElementById('close-modal');
            mainTitleEl = document.getElementById('main-title');
            subTextEl = document.getElementById('sub-text');
            editContainer = document.getElementById('edit-mode-container');
            contentDisplay = document.getElementById('content-display');
            editTitleEl = document.getElementById('edit-title');
            editSubtitleEl = document.getElementById('edit-subtitle');
            topContentArea = document.getElementById('top-content-area');

            // Admin Text Edit Elements
            editWebTitleEl = document.getElementById('edit-web-title'); 
            editTitleSizeEl = document.getElementById('edit-title-size');
            editTitleWeightEl = document.getElementById('edit-title-weight');
            editTitleColorPickerEl = document.getElementById('edit-title-color-picker');
            editTitleSpacingEl = document.getElementById('edit-title-spacing');
            editSubtitleSizeEl = document.getElementById('edit-subtitle-size');
            editSubtitleWeightEl = document.getElementById('edit-subtitle-weight');
            editSubtitleColorPickerEl = document.getElementById('edit-subtitle-color-picker');
            editSubtitleSpacingEl = document.getElementById('edit-subtitle-spacing');

            // ** è§†è§‰å‚æ•°å…ƒç´  **
            editFisheyeRadiusEl = document.getElementById('edit-fisheye-radius');
            editDecayPowerEl = document.getElementById('edit-decay-power');
            editMinScaleEl = document.getElementById('edit-min-scale');
            editMaxScaleEl = document.getElementById('edit-max-scale'); 
            editParallaxSmoothingEl = document.getElementById('edit-parallax-smoothing'); // å¹³æ»‘åº¦å…ƒç´ 


            // Admin UI elements
            adminToggleBtn = document.getElementById('admin-toggle-btn');
            itemEditModal = document.getElementById('item-edit-modal');
            itemEditIdEl = document.getElementById('item-edit-id');
            editImageUrlEl = document.getElementById('edit-image-url');
            editVideoUrlEl = document.getElementById('edit-video-url');
            // Auth UI elements
            authModal = document.getElementById('auth-modal');
            authUsernameEl = document.getElementById('auth-username');
            authPasswordEl = document.getElementById('auth-password');
            authErrorMessageEl = document.getElementById('auth-error-message');
            
            // --- 2. ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ ---

            window.addEventListener('mousemove', (e) => {
                mousePos.x = e.clientX;
                mousePos.y = e.clientY;

                if (!isMouseActive) {
                    isMouseActive = true;
                    startAnimationLoop();
                }
            });

            window.addEventListener('mouseenter', () => {
                if (!isMouseActive) {
                    isMouseActive = true;
                    startAnimationLoop();
                }
            });

            window.addEventListener('mouseleave', () => {
                isMouseActive = false;
                resetGrid(); 
            });

            gridContainer.addEventListener('click', (e) => {
                const itemElement = e.target.closest('.grid-item');
                if (itemElement) {
                    const itemId = itemElement.dataset.videoId;
                    
                    if (isAdminMode) {
                        window.openItemEditPanel(itemElement);
                        return; 
                    }

                    isMouseActive = false; 
                    const videoSrc = itemData[itemId]?.vid || PLACEHOLDER_VID;
                    openVideoModal(videoSrc);
                }
            });

            closeModal.addEventListener('click', closeVideoModalFunc);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeVideoModalFunc();
                }
            });

            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    cacheItemPositions();
                }, 100);
            });

            window.addEventListener('contextmenu', (e) => {
                if (e.button === 1) {
                    e.preventDefault();
                }
            });
            
            // åˆå§‹åŒ– Admin Mode æ ·å¼ (é»˜è®¤å…³é—­)
            window.setAdminMode(false); 
        }


        /**
         * å¯åŠ¨åº”ç”¨ï¼ˆåˆå§‹åŒ– Firebase & ç›‘å¬å™¨ï¼‰
         */
        window.setupApp = async () => {
            
            setupDOMAndListeners();

            const hasFirebaseConfig = Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey.includes('AIzaSyD'); 

            if (!hasFirebaseConfig) {
                window.runLocalFallback();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                setLogLevel('error'); 

                let authSuccess = false;
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken).then(() => { authSuccess = true; }).catch(e => { console.error("Custom token sign-in failed (ignored for GH Pages):", e); });
                }
                
                if (!authSuccess) {
                    try {
                        await signInAnonymously(auth);
                        authSuccess = true;
                    } catch (e) {
                        console.error("Anonymous sign-in failed:", e);
                        window.runLocalFallback();
                        return;
                    }
                }
                
                const unsubscribe = onAuthStateChanged(auth, (user) => { 
                    if (user) {
                        console.log("User state confirmed. Setting up Firestore listeners.");
                        // ä½¿ç”¨æ–°çš„è®¾ç½®æ–‡æ¡£è·¯å¾„
                        window.setupContentListener(db, appId);
                        window.setupGridListener(db, appId);
                        unsubscribe();
                    } else {
                        console.warn("User is not logged in. Waiting for sign-in state.");
                    }
                }, (error) => {
                     console.error("onAuthStateChanged error:", error);
                     window.runLocalFallback();
                });
                
            } catch (error) {
                console.error("Firebase Initialization/Sign-In Error, falling back:", error);
                window.runLocalFallback();
            }
        };

        window.addEventListener('load', window.setupApp);

        // --- æ ¸å¿ƒåŠ¨ç”»/äº¤äº’å‡½æ•° (ä½¿ç”¨åŠ¨æ€å‚æ•° & åŠ é€Ÿ) ---

        function cacheItemPositions() {
            if (!gridContainer) return; 
            
            const oldTransform = gridContainer.style.transform;
            gridContainer.style.transform = ''; 

            for (const item of items) {
                const rect = item.el.getBoundingClientRect();
                item.center = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }

            gridContainer.style.transform = oldTransform;
        }

        function applyGridTransform() {
            if (!gridContainer) return; 

            const finalX = parallaxOffset.x;
            const finalY = parallaxOffset.y;
            gridContainer.style.transform = `translate3d(${finalX}px, ${finalY}px, 0)`; 
        }

        /**
         * ã€æ–°å¢å‡½æ•°ã€‘å°†æ‰€æœ‰ç½‘æ ¼å…ƒç´ å¤ä½åˆ°åˆå§‹å¤§å°ã€‚
         */
        function resetGridScale() {
            if (items.length === 0) return; 
            
            // ä½¿ç”¨åŠ¨æ€åˆå§‹å¤§å°è¿›è¡Œå¤ä½
            for (const item of items) {
                item.el.style.transform = `scale(${currentMinScale})`;
                item.el.style.opacity = '0.7';
                item.el.style.zIndex = 1;
                item.el.style.filter = 'brightness(1.0)'; 
            }
        }

        function updateFisheyeEffect() {
            if (!gridContainer) { 
                 animationFrameId = null;
                 return;
            }
            
            // --- 1. è§†å·®åç§»è®¡ç®—ä¸åº”ç”¨ (ä½¿ç”¨åŠ¨æ€å¹³æ»‘åº¦) ---
            const viewportCenterX = window.innerWidth / 2;
            const viewportCenterY = window.innerHeight / 2;
            
            const targetParallaxX = (mousePos.x - viewportCenterX) * PARALLAX_INTENSITY;
            const targetParallaxY = (mousePos.y - viewportCenterY) * PARALLAX_INTENSITY;
            
            // ä½¿ç”¨åŠ¨æ€å¹³æ»‘ç³»æ•° currentParallaxSmoothing
            parallaxOffset.x += (targetParallaxX - parallaxOffset.x) * currentParallaxSmoothing;
            parallaxOffset.y += (targetParallaxY - parallaxOffset.y) * currentParallaxSmoothing;
            
            applyGridTransform(); 

            if (isAdminMode) {
                // ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œåªæ‰§è¡Œè§†å·®ï¼Œä¸æ‰§è¡Œé±¼çœ¼å’Œé—ªçƒæ•ˆæœ
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
                return;
            }

            // --- 2. é±¼çœ¼æ•ˆæœè®¡ç®— (ä½¿ç”¨åŠ¨æ€å‚æ•°) ---
            const fisheyeCenterX = mousePos.x;
            const fisheyeCenterY = mousePos.y;
            // åŠ¨æ€è¯»å–é…ç½®å‚æ•°
            const fisheyeRadius = currentFisheyeRadius;
            const minScale = currentMinScale;
            const decayPower = currentDecayPower;
            const maxScale = currentMaxScale; // ä½¿ç”¨åŠ¨æ€çš„æœ€å¤§æ”¾å¤§å€æ•°


            for (const item of items) {
                const adjustedItemCenterX = item.center.x + parallaxOffset.x; 
                const adjustedItemCenterY = item.center.y + parallaxOffset.y; 

                const dx = fisheyeCenterX - adjustedItemCenterX;
                const dy = fisheyeCenterY - adjustedItemCenterY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                let scale;
                let opacity;
                let zIndex = 1;
                let brightness = 1.0; 

                if (dist >= fisheyeRadius) { // ä½¿ç”¨åŠ¨æ€åŠå¾„
                    
                    opacity = 0.7;
                    
                    // --- 3. å¼ºåŒ–é—ªçƒæ•ˆæœ (Twinkling: äº®åº¦ + å¤§å°) ---
                    item.twinklePhase += (0.02 + Math.random() * 0.01) * item.twinkleSpeed;
                    const sineVal = (Math.sin(item.twinklePhase) + 1) / 2;
                    
                    const minBrightness = 0.2; 
                    const maxBrightness = 1.4; 
                    const brightnessRange = maxBrightness - minBrightness; 
                    brightness = minBrightness + (brightnessRange * sineVal);
                    
                    // ä½¿ç”¨åŠ¨æ€åˆå§‹å¤§å°è®¡ç®—é—ªçƒèŒƒå›´
                    const minTwinkleScale = minScale * 0.70; 
                    const maxTwinkleScale = minScale * 1.30; 
                    const scaleRange = maxTwinkleScale - minTwinkleScale;
                    
                    const sineTwinkleScale = (Math.sin(item.twinklePhase) + 1) / 2; 
                    scale = minTwinkleScale + (scaleRange * sineTwinkleScale); 
                    
                } else {
                    // é±¼çœ¼æ•ˆæœåŒºåŸŸ
                    const proximity = 1 - (dist / fisheyeRadius);
                    
                    // ä½¿ç”¨åŠ¨æ€è¡°å‡å¹…åº¦ (decayPower)
                    const easedProximity = 1 - Math.pow(1 - proximity, decayPower); 
                    
                    // ä½¿ç”¨åŠ¨æ€åˆå§‹å¤§å° minScale å’ŒåŠ¨æ€æœ€å¤§æ”¾å¤§å€æ•° maxScale
                    scale = minScale + (maxScale - minScale) * easedProximity;
                    opacity = 0.7 + (1.0 - 0.7) * easedProximity;
                    
                    // Z-index é€»è¾‘ï¼šè·ç¦»é¼ æ ‡è¶Šè¿‘ï¼ˆproximity è¶Šé«˜ï¼‰ï¼ŒzIndex è¶Šé«˜
                    // zIndex èŒƒå›´ä» 2 (è¾¹ç¼˜) åˆ° 10 (ä¸­å¿ƒ)
                    zIndex = 2 + Math.floor(proximity * 8); 
                    brightness = 1.0; 
                }

                item.el.style.transform = `translateZ(0) scale(${scale})`;
                item.el.style.opacity = opacity;
                item.el.style.zIndex = zIndex;
                item.el.style.filter = `brightness(${brightness})`;
            }
            
            if (isMouseActive) { 
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
            } else {
                animationFrameId = null; 
            }
        }

        function startAnimationLoop() {
            if (!gridContainer) return; 
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
            }
        }

        function resetGrid() {
            if (items.length === 0 || !gridContainer) return; 

            // è°ƒç”¨æ–°çš„å¤ä½å‡½æ•°
            resetGridScale(); 

            parallaxOffset = { x: 0, y: 0 };
            applyGridTransform(); 
        }

        function openVideoModal(videoSrc) {
            if (!modal || !videoPlayer) return; 

            videoPlayer.src = videoSrc;
            modal.classList.remove('hidden');
            videoPlayer.play().catch(e => {
                if (e.name !== 'AbortError') {
                    console.error("è§†é¢‘æ’­æ”¾å¤±è´¥:", e);
                }
            });
        }

        function closeVideoModalFunc() {
            if (!modal || !videoPlayer) return; 

            modal.classList.add('hidden');
            videoPlayer.pause();
            videoPlayer.src = ''; 
            isMouseActive = true; 
            startAnimationLoop();
        }

    </script>
    <div id="app-container" class="relative min-h-screen w-full bg-black overflow-hidden">

        <!-- é¡¶éƒ¨å†…å®¹åŒºåŸŸ/ç¼–è¾‘æ¨¡å¼ -->
        <div id="top-content-area" class="fixed top-0 left-0 right-0 p-8 md:p-12 z-20 text-white pointer-events-none transition-all duration-300">
            <div id="content-display" class="flex flex-col">
                <h1 id="main-title" class="text-white text-4xl font-extrabold cursor-text transition-colors duration-500 hover:text-yellow-400 pointer-events-auto" onclick="toggleEditMode(true)">3D&Motion Creative&Production</h1>
                <p id="sub-text" class="text-gray-400 text-base font-normal cursor-text transition-colors duration-500 hover:text-gray-200 pointer-events-auto" onclick="toggleEditMode(true)">Powerd by REDesign</p>
            </div>

            <!-- ç¼–è¾‘æ¨¡å¼ UI (Admin Only) -->
            <div id="edit-mode-container" class="hidden bg-gray-900/90 backdrop-blur-sm p-6 rounded-xl shadow-2xl pointer-events-auto">
                <h2 class="text-xl font-bold mb-4 text-red-400">é¡¶éƒ¨å†…å®¹åŠè§†è§‰å‚æ•°ç¼–è¾‘ (Admin)</h2>
                
                <div class="space-y-4">
                    <!-- Web Title -->
                    <div>
                        <label class="block text-sm font-medium text-gray-400">ç½‘ç«™æ ‡é¢˜ (Title)</label>
                        <input id="edit-web-title" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†">
                    </div>
                    
                    <!-- Main Title Edit -->
                    <div class="p-4 bg-gray-800 rounded-lg">
                        <label class="block text-lg font-medium text-white mb-2">ä¸»æ ‡é¢˜</label>
                        <input id="edit-title" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="3D&Motion Creative&Production">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 text-sm">
                            <select id="edit-title-size" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="text-8xl">ç‰¹å¤§å·</option>
                                <option value="text-6xl">å¤§å·</option>
                                <option value="text-4xl">ä¸­å·</option>
                            </select>
                            <select id="edit-title-weight" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="font-extrabold">æç²—</option>
                                <option value="font-bold">ç²—ä½“</option>
                                <option value="font-semibold">åŠç²—</option>
                            </select>
                            <input id="edit-title-color-picker" type="color" class="h-10 w-full rounded-md bg-gray-700 border-gray-600 p-1 cursor-pointer" value="#FFFFFF">
                            <select id="edit-title-spacing" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="tracking-normal">é»˜è®¤é—´è·</option>
                                <option value="tracking-wider">æ›´å®½</option>
                                <option value="tracking-tight">æ›´ç´§</option>
                            </select>
                        </div>
                    </div>

                    <!-- Subtitle Edit -->
                    <div class="p-4 bg-gray-800 rounded-lg">
                        <label class="block text-lg font-medium text-white mb-2">å‰¯æ ‡é¢˜</label>
                        <input id="edit-subtitle" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="Powerd by REDesign">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 text-sm">
                            <select id="edit-subtitle-size" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="text-2xl">å¤§å·</option>
                                <option value="text-xl">ä¸­å·</option>
                                <option value="text-base">å°å·</option>
                            </select>
                            <select id="edit-subtitle-weight" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="font-normal">é»˜è®¤</option>
                                <option value="font-bold">ç²—ä½“</option>
                                <option value="font-extrabold">æç²—</option>
                            </select>
                            <input id="edit-subtitle-color-picker" type="color" class="h-10 w-full rounded-md bg-gray-700 border-gray-600 p-1 cursor-pointer" value="#9CA3AF">
                            <select id="edit-subtitle-spacing" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="tracking-normal">é»˜è®¤é—´è·</option>
                                <option value="tracking-widest">æœ€å®½</option>
                                <option value="tracking-tight">æ›´ç´§</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ç½‘æ ¼è§†è§‰å‚æ•°ç¼–è¾‘ - è°ƒæ•´ä¸ºå“åº”å¼ 5 åˆ—å¸ƒå±€ -->
                    <div class="p-4 bg-gray-800 rounded-lg">
                        <label class="block text-lg font-medium text-white mb-4">ç½‘æ ¼è§†è§‰å‚æ•°</label>
                        <!-- è°ƒæ•´ä¸º md:grid-cols-3 lg:grid-cols-5 ä»¥å®¹çº³ 5 ä¸ªå…ƒç´  -->
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-400">é±¼çœ¼åŠå¾„ (px)</label>
                                <input id="edit-fisheye-radius" type="number" step="10" min="100" max="1000" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400">è¡°å‡å¹…åº¦ (1.0 - 5.0)</label>
                                <input id="edit-decay-power" type="number" step="0.1" min="1.0" max="5.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="2.0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400">åˆå§‹å¤§å° (0.01 - 1.0)</label>
                                <input id="edit-min-scale" type="number" step="0.01" min="0.01" max="1.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="0.175">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400">æœ€å¤§æ”¾å¤§å€æ•°</label>
                                <input id="edit-max-scale" type="number" step="0.1" min="1.0" max="5.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="3.0">
                            </div>
                            <!-- åŠ¨ç”»å¹³æ»‘åº¦è°ƒèŠ‚ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-400">åŠ¨ç”»å¹³æ»‘åº¦ (0.01 - 1.0)</label>
                                <input id="edit-parallax-smoothing" type="number" step="0.01" min="0.01" max="1.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="0.2">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="saveContent()">ä¿å­˜æ›´æ”¹</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="toggleEditMode(false)">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- Admin Toggle Button (å§‹ç»ˆå¯è§ï¼Œä½†åŠŸèƒ½å—é™) -->
        <button id="admin-toggle-btn" onclick="handleAdminToggle()" 
            class="fixed bottom-4 right-4 z-50 w-12 h-12 flex items-center justify-center rounded-full text-black text-base font-bold shadow-xl transition-all duration-300 bg-gray-300 hover:bg-gray-400">
            (R)
        </button>


        <!-- ç½‘æ ¼å®¹å™¨ (ä½äºä¸­å¿ƒ) -->
        <div id="grid-container" class="absolute inset-0 m-auto grid" 
            style="transform: translate(0, 0); transform-style: preserve-3d;">
            <!-- Grid items will be generated here by JavaScript -->
        </div>

        <!-- è§†é¢‘æ¨¡æ€æ¡† (ç”¨äºæ’­æ”¾é€‰ä¸­çš„é¡¹ç›®) -->
        <div id="video-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="relative w-full max-w-4xl h-auto aspect-video rounded-xl shadow-2xl overflow-hidden">
                <video id="video-player" class="w-full h-full object-cover" controls autoplay playsinline></video>
                <button id="close-modal" class="absolute top-4 right-4 text-white p-2 rounded-full bg-black/50 hover:bg-black/80 transition" aria-label="Close video">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Admin Item Edit Modal -->
        <div id="item-edit-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <h2 class="text-xl font-bold text-red-400 mb-4">ç¼–è¾‘ç½‘æ ¼é¡¹ç›® <span id="item-edit-id" class="text-sm text-gray-400"></span></h2>
                
                <div class="space-y-4 text-white">
                    <div>
                        <label class="block text-sm font-medium text-gray-300">å›¾åƒ URL (Image URL - ç•™ç©ºåˆ™æ˜¾ç¤ºé¢œè‰²)</label>
                        <input id="edit-image-url" type="text" placeholder="https://example.com/image.jpg" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300">è§†é¢‘ URL (Video URL - æ’­æ”¾æ—¶ä½¿ç”¨)</label>
                        <input id="edit-video-url" type="text" placeholder="https://example.com/video.mp4" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="saveItemChanges()">ä¿å­˜é¡¹ç›®</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="closeItemEditPanel()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        
        <!-- Admin Auth Modal -->
        <div id="auth-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-sm">
                <h2 class="text-xl font-bold text-white mb-4">ç®¡ç†å‘˜ç™»å½•</h2>
                
                <div class="space-y-4 text-white">
                    <div>
                        <label class="block text-sm font-medium text-gray-300">ç”¨æˆ·å</label>
                        <input id="auth-username" type="text" value="admin" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300">å¯†ç </label>
                        <!-- å¯†ç è¾“å…¥æ¡†å·²æ¸…ç©º -->
                        <input id="auth-password" type="password" value="" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                    <p id="auth-error-message" class="text-red-400 text-sm hidden">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚</p>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="handleAdminLogin()">ç™»å½•</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="closeAuthModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
